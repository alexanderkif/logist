(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"8b24":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"flex flex-center q-pb-lg"},[s("div",{staticClass:"row justify-center items-center q-mt-lg"},[s("div",{staticClass:"col col-auto"},[s("a",{staticClass:"text-primary",attrs:{href:"logist.csv"}},[e._v("Скачать пример файла logist.csv")])]),s("div",{staticClass:"col"},[s("q-file",{staticClass:"q-ml-lg",staticStyle:{width:"300px"},attrs:{label:"Загрузить CSV файл",outlined:""},on:{input:e.input},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1)]),s("div",{staticClass:"row full-width justify-center"},[s("q-table",{staticClass:"q-mt-lg",attrs:{title:"Координаты магазинов",data:e.shops,columns:e.shopColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":""}}),s("q-table",{staticClass:"q-mt-lg q-ml-lg",attrs:{title:"Заказы магазинов по дням недели",data:e.orders,columns:e.ordersColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":""},scopedSlots:e._u([{key:"body",fn:function(t){return[s("q-tr",{attrs:{props:t}},[s("q-td",{key:"ttId",attrs:{props:t}},[e._v("\n            "+e._s(t.row.ttId)+"\n          ")]),s("q-td",{key:"monP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.p)+"\n          ")]),s("q-td",{key:"monM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.m)+"\n          ")]),s("q-td",{key:"monN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.n)+"\n          ")]),s("q-td",{key:"tueP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.p)+"\n          ")]),s("q-td",{key:"tueM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.m)+"\n          ")]),s("q-td",{key:"tueN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.n)+"\n          ")]),s("q-td",{key:"wedP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.p)+"\n          ")]),s("q-td",{key:"wedM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.m)+"\n          ")]),s("q-td",{key:"wedN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.n)+"\n          ")]),s("q-td",{key:"thuP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.p)+"\n          ")]),s("q-td",{key:"thuM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.m)+"\n          ")]),s("q-td",{key:"thuN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.n)+"\n          ")]),s("q-td",{key:"friP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.p)+"\n          ")]),s("q-td",{key:"friM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.m)+"\n          ")]),s("q-td",{key:"friN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.n)+"\n          ")])],1)]}}])})],1),e.weekCounted?s("PrintWaysByDays",{attrs:{week:e.week}}):e._e()],1)},l=[],r=(s("e6cf"),s("ddb0"),s("4e82"),s("13d5"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._l(e.week,(function(t){return s("div",{key:t.day,staticClass:"row q-pt-xl"},[s("div",{staticClass:"full-width text-center text-h5 text-bold bg-purple-2"},[e._v(e._s(t.day.toUpperCase()))]),s("div",{staticClass:"flex justify-center"},e._l(t.cars,(function(e){return s("div",{key:e.id,staticClass:"q-ml-md"},[s("Way",{attrs:{way:e}})],1)})),0)])})),e.paths&&e.paths.length?s("div",e._l(e.paths,(function(t){return s("div",{key:t.path,staticClass:"row q-pt-xl"},[s("div",{staticClass:"row full-width justify-center"},[s("q-table",{staticClass:"q-mt-lg",attrs:{title:e.week[t.day-1].day.toUpperCase(),data:e.getCountedPath(t.paths),columns:e.pathColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":""}})],1)])})),0):e._e()],2)}),n=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-card",{staticClass:"row q-mt-lg"},[s("q-card-section",[s("q-table",{attrs:{title:"Маршрут № "+e.way.id,data:e.way.orders,columns:e.orderColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":"",dense:"",flat:"",bordered:""}})],1),s("q-card-section",[s("div",{staticClass:"row text-bold"},[e._v("\n      Результаты расчета по маршруту\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Путь объезда магазинов по маршруту"),s("br"),e._v("\n      "+e._s("M = "+e.way.bestSeq)+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Количество перевезенного груза"),s("br"),e._v("\n      "+e._s("P = "+e.way.sum)+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      "+e._s("Длина маршрута L = "+e.way.bestSeqKM+" км")+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Время работы машины на маршруте"),s("br"),e._v("\n      "+e._s("T = "+e.way.bestSeqKM+"*3 + "+e.way.sum+"*0.5 + "+(e.way.bestSeq.split("-").length-2)+"*15 = "+e.way.time+" мин")+"\n    ")])])],1)},o=[],p={name:"Way",props:{way:Object},data(){return{orderColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",classes:"bg-purple-2",headerClasses:"bg-purple-2 text-bold"},{name:"p",label:"П",field:"p"},{name:"m",label:"М",field:"m"},{name:"n",label:"Н",field:"n"}]}},methods:{}},d=p,m=s("2877"),h=s("f09f"),u=s("a370"),c=s("eaac"),g=s("eebe"),y=s.n(g),f=Object(m["a"])(d,i,o,!1,null,null,null),b=f.exports;y()(f,"components",{QCard:h["a"],QCardSection:u["a"],QTable:c["a"]});const w=605,C=110;var _={name:"PrintWaysByDays",components:{Way:b},props:{week:Array},data(){return{paths:[],pathColumns:[{name:"id",align:"center",label:"Номер машины",field:"id"},{name:"path1",align:"center",label:"Номер маршрута",field:"path1",classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"o1",label:"Отправление",field:"o1"},{name:"p1",label:"Прибытие",field:"p1"},{name:"path2",align:"center",label:"Номер маршрута",field:"path2",classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"o2",label:"Отправление",field:"o2"},{name:"p2",label:"Прибытие",field:"p2"},{name:"path3",align:"center",label:"Номер маршрута",field:"path3",classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"o3",label:"Отправление",field:"o3"},{name:"p3",label:"Прибытие",field:"p3"},{name:"km",label:"Длина",field:"km"},{name:"time",label:"Время",field:"time"}]}},async mounted(){if(!(this.week.length<5))for(let e=1;e<6;e++)this.paths.push({day:e,paths:await this.getPathByDay(e)})},methods:{getCountedPath(e){let t=1,s=[];return e.forEach((e=>{const a={};a.id=t++,a.path1=e.path[0].id,a.o1=this.getDigitClock(480),a.p1=this.getDigitClock(+e.path[0].time+480),a.path2=e.path[1]?e.path[1].id:"",a.o2=e.path[1]?this.getDigitClock(+e.path[0].time+480+30):"",a.p2=e.path[1]?this.getDigitClock(+e.path[0].time+480+30+ +e.path[1].time):"",a.path3=e.path[2]?e.path[2].id:"",a.o3=e.path[2]?this.getDigitClock(+e.path[0].time+480+30+ +e.path[1].time+30):"",a.p3=e.path[2]?this.getDigitClock(+e.path[0].time+480+30+ +e.path[1].time+30+ +e.path[2].time):"",a.km=e.sumKM,a.time=e.sumTime,s.push(a)})),s},getDigitClock(e){let t=""+Math.trunc(+e/60),s=""+ +e%60;return`${1===t.length?"0"+t:t}:${1===s.length?"0"+s:s}`},getWaysSortByTime(e){return e?e.cars.slice(0).sort(((e,t)=>+t.time-+e.time)):[]},async getPathByDay(e){let t=await this.getWaysSortByTime(this.week[e-1]);console.log(`======= Day ${e} ========`),console.log(`wayByTime ${e}`,t.map((e=>e.time)));const s=[];return t=await this.getNextPath(s,t),console.log(`wayByTime ${e} after`,t.map((e=>e.time))),console.log(`paths ${e} sumTime`,s.map((e=>e.sumTime))),console.log(`paths ${e} sumKM`,s.map((e=>e.sumKM))),console.log(`paths ${e}`,s),s},async getNextPath(e,t){if(!t.length)return t;if(t.length<2)return this.pushOnePath(e,t);const s=t.slice(1).filter((e=>e.time<w-30-t[0].time))[0];if(s){let a={sumKM:+t[0].bestSeqKM+ +s.bestSeqKM,sumTime:t[0].time+30+s.time,path:[t[0],s]};t.splice(t.indexOf(s),1),t=this.getPathArray(a,t.slice(1)),e.push(a)}else t=this.pushOnePath(e,t);return await this.getNextPath(e,t)},getPathArray(e,t){const s=t.filter((t=>t.time<w-30-e.sumTime))[0];return s&&e.sumKM+ +s.bestSeqKM<C&&(e.path.push(s),e.sumKM+=+s.bestSeqKM,e.sumTime+=30+s.time,t.splice(t.indexOf(s),1),t=this.getPathArray(e,t)),t},pushOnePath(e,t){return e.push({sumKM:+t[0].bestSeqKM,sumTime:t[0].time,path:[t[0]]}),t.slice(1)}}},k=_,q=Object(m["a"])(k,r,n,!1,null,null,null),v=q.exports;y()(q,"components",{QTable:c["a"]});const x=9;var T={name:"PageIndex",components:{PrintWaysByDays:v},data(){return{file:null,textFile:null,shops:[],orders:[],week:[],weekCounted:!1,TT:30,shopColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",sortable:!0,classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"x",label:"X",field:"x"},{name:"y",label:"Y",field:"y"}],ordersColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",sortable:!0,classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"monP",label:"пн П",field:"monP"},{name:"monM",label:"пн М",field:"monM"},{name:"monN",label:"пн Н",field:"monN"},{name:"tueP",label:"вт П",field:"tueP",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"tueM",label:"вт М",field:"tueM",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"tueN",label:"вт Н",field:"tueN",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"wedP",label:"ср П",field:"wedP"},{name:"wedM",label:"ср М",field:"wedM"},{name:"wedN",label:"ср Н",field:"wedN"},{name:"thuP",label:"чт П",field:"thuP",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"thuM",label:"чт М",field:"thuM",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"thuN",label:"чт Н",field:"thuN",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"friP",label:"пт П",field:"friP"},{name:"friM",label:"пт М",field:"friM"},{name:"friN",label:"пт Н",field:"friN"}]}},methods:{async input(){const e=new FileReader;e.readAsText(this.file),this.textFile=await new Promise(((t,s)=>{e.onload=s=>t(e.result)})),await this.setShops(),await this.setOrders();for(let t of["mon","tue","wed","thu","fri"])this.week.push({day:t,cars:await this.loadWaysByDays(t)});console.log("this.week",this.week),this.weekCounted=!0},async loadWaysByDays(e){let t=await this.getDayOrders(e);console.log(`===== Cars for ${e.toUpperCase()} =====`);let s=[],a=1,l=!0,r=!0,n=null;while(l)n=await this.loadWayP(t,a),this.getWayBoxes(n)>0&&(s.push(n),a++),this.getWayBoxes(n)<120&&(l=!1);while(r)n=await this.loadWayM(t,a),this.getWayBoxes(n)>0&&(s.push(n),a++),this.getCountBoxes(t)<1&&(r=!1);return console.log("cars",s),console.log("dayOrders",t),s},loadWayM(e,t){let s=0,a={id:t,orders:[]},l=0;for(let r=0;r<e.length;r++)if(+e[r].m+ +e[r].n>0&&s+ +e[r].m+ +e[r].n<=120&&(r-l<x||0===l)){let t={ttId:r+1};+e[r].m>0&&(t.m=+e[r].m),+e[r].n>0&&(t.n=+e[r].n),a.orders.push(t),s+=+e[r].m+ +e[r].n,e[r].m=0,e[r].n=0,l=r}return a.sum=this.getWayBoxes(a),a=this.getSequenceTT(a),a},loadWayP(e,t){let s=0,a=0,l=0;while(s<this.TT&&0===+e[s].p)s++;let r={id:t,orders:[]};while(s+a<this.TT&&l+ +e[s+a].p<=120)+e[s+a].p>0&&(r.orders.push({ttId:s+a+1,p:+e[s+a].p}),l+=+e[s+a].p,e[s+a].p=0),a++;a=0;while(s+a<this.TT&&l+ +e[s+a].n<=120)r.orders[a].p>0&&(r.orders[a].n=+e[s+a].n,l+=+e[s+a].n,e[s+a].n=0),a++;return s+a<this.TT&&(r.orders[a].n=120-l,e[s+a].n-=120-l),r.sum=this.getWayBoxes(r),r=this.getSequenceTT(r),r},getSequenceTT(e){const t=e.orders.map((e=>e.ttId));if(!t.length)return"0";const s=this.getNextTT("0",t),a=s.sort(((e,t)=>+e.split("km")[1]>+t.split("km")[1]?1:-1));e.bestSeq=a[0].split("km")[0],e.bestSeqKM=a[0].split("km")[1];const l=e.bestSeq.split("-").length;return e.time=3*+e.bestSeqKM+.5*+e.sum+15*(l-2),e},getNextTT(e,t){if(t.length<2){const s=`${e}-${t[0]}-0`;return[`${s}km${this.getKM(s)}`]}let s=[];return t.forEach((a=>{s=[...s,...this.getNextTT(`${e}-${a}`,t.filter((e=>e!==a)))]})),s},getKM(e){const t=e.split("-");let s=0;for(let a=0;a<t.length-1;a++){const e=this.shops.filter((e=>e.ttId===t[a]))[0],l=this.shops.filter((e=>e.ttId===t[a+1]))[0];s+=Math.abs(+e.x-+l.x)+Math.abs(+e.y-+l.y)}return s},getWayBoxes(e){return e.orders&&e.orders.length?e.orders.map((e=>(e.p?e.p:0)+(e.n?e.n:0)+(e.m?e.m:0))).reduce(((e,t)=>e+t)):0},getCountBoxes(e){return e.length?e.map((e=>(e.p?e.p:0)+(e.n?e.n:0)+(e.m?e.m:0))).reduce(((e,t)=>e+t)):0},setShops(){this.shops=this.textFile.replaceAll("\r","").split("\n").slice(2,33).map((e=>e.split(";").slice(0,3))).map((e=>({ttId:e[0],x:e[1],y:e[2]})))},setOrders(){this.orders=this.textFile.replaceAll("\r","").split("\n").slice(2,32).map((e=>[e.split(";")[0],...e.split(";").slice(3,18)])).map((e=>({ttId:e[0],mon:{p:e[1],m:e[2],n:e[3]},tue:{p:e[4],m:e[5],n:e[6]},wed:{p:e[7],m:e[8],n:e[9]},thu:{p:e[10],m:e[11],n:e[12]},fri:{p:e[13],m:e[12],n:e[13]}})))},getDayOrders(e){switch(e){case"mon":return this.orders.map((e=>({ttId:e.ttId,p:e.mon.p,m:e.mon.m,n:e.mon.n})));case"tue":return this.orders.map((e=>({ttId:e.ttId,p:e.tue.p,m:e.tue.m,n:e.tue.n})));case"wed":return this.orders.map((e=>({ttId:e.ttId,p:e.wed.p,m:e.wed.m,n:e.wed.n})));case"thu":return this.orders.map((e=>({ttId:e.ttId,p:e.thu.p,m:e.thu.m,n:e.thu.n})));case"fri":return this.orders.map((e=>({ttId:e.ttId,p:e.fri.p,m:e.fri.m,n:e.fri.n})));default:return{}}}}},M=T,P=s("9989"),I=s("7d53"),S=s("bd08"),N=s("db86"),W=Object(m["a"])(M,a,l,!1,null,null,null);t["default"]=W.exports;y()(W,"components",{QPage:P["a"],QFile:I["a"],QTable:c["a"],QTr:S["a"],QTd:N["a"]})}}]);