(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"8b24":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"flex flex-center q-pb-lg"},[s("div",{staticClass:"row justify-center items-center q-mt-lg"},[s("div",{staticClass:"col col-auto"},[s("a",{staticClass:"text-primary",attrs:{href:"logist.csv"}},[e._v("Скачать пример файла logist.csv")])]),s("div",{staticClass:"col"},[s("q-file",{staticClass:"q-ml-lg",staticStyle:{width:"300px"},attrs:{label:"Загрузить CSV файл",outlined:""},on:{input:e.input},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1)]),s("div",{staticClass:"row full-width justify-center"},[s("q-table",{staticClass:"q-mt-lg",attrs:{title:"Координаты магазинов",data:e.shops,columns:e.shopColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":""}}),s("q-table",{staticClass:"q-mt-lg q-ml-lg",attrs:{title:"Заказы магазинов по дням недели",data:e.orders,columns:e.ordersColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":""},scopedSlots:e._u([{key:"body",fn:function(t){return[s("q-tr",{attrs:{props:t}},[s("q-td",{key:"ttId",attrs:{props:t}},[e._v("\n            "+e._s(t.row.ttId)+"\n          ")]),s("q-td",{key:"monP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.p)+"\n          ")]),s("q-td",{key:"monM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.m)+"\n          ")]),s("q-td",{key:"monN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.mon.n)+"\n          ")]),s("q-td",{key:"tueP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.p)+"\n          ")]),s("q-td",{key:"tueM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.m)+"\n          ")]),s("q-td",{key:"tueN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.tue.n)+"\n          ")]),s("q-td",{key:"wedP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.p)+"\n          ")]),s("q-td",{key:"wedM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.m)+"\n          ")]),s("q-td",{key:"wedN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.wed.n)+"\n          ")]),s("q-td",{key:"thuP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.p)+"\n          ")]),s("q-td",{key:"thuM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.m)+"\n          ")]),s("q-td",{key:"thuN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.thu.n)+"\n          ")]),s("q-td",{key:"friP",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.p)+"\n          ")]),s("q-td",{key:"friM",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.m)+"\n          ")]),s("q-td",{key:"friN",attrs:{props:t}},[e._v("\n            "+e._s(t.row.fri.n)+"\n          ")])],1)]}}])})],1),s("PrintWaysByDays",{attrs:{week:e.week}})],1)},r=[],l=(s("e6cf"),s("ddb0"),s("4e82"),s("13d5"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._l(e.week,(function(t){return s("div",{key:t.day,staticClass:"row q-pt-xl"},[s("div",{staticClass:"full-width text-center text-h5 text-bold bg-purple-2"},[e._v(e._s(t.day.toUpperCase()))]),s("div",{staticClass:"flex justify-center"},e._l(t.cars,(function(e){return s("div",{key:e.id,staticClass:"q-ml-md"},[s("Way",{attrs:{way:e}})],1)})),0)])})),0)}),n=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-card",{staticClass:"row q-mt-lg"},[s("q-card-section",[s("q-table",{attrs:{title:"Маршрут № "+e.way.id,data:e.way.orders,columns:e.orderColumns,"rows-per-page-options":[0],"row-key":"ttId","hide-bottom":"",dense:"",flat:"",bordered:""}})],1),s("q-card-section",[s("div",{staticClass:"row text-bold"},[e._v("\n      Результаты расчета по маршруту\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Путь объезда магазинов по маршруту"),s("br"),e._v("\n      "+e._s("M = "+e.way.bestSeq)+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Количество перевезенного груза"),s("br"),e._v("\n      "+e._s("P = "+e.way.sum)+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      "+e._s("Длина маршрута L = "+e.way.bestSeqKM+" км")+"\n    ")]),s("div",{staticClass:"row"},[e._v("\n      Время работы машины на маршруте"),s("br"),e._v("\n      "+e._s("T = "+e.way.bestSeqKM+"*3 + "+e.way.sum+"*0.5 + "+(e.way.bestSeq.split("-").length-2)+"*15 = "+e.way.time+" мин")+"\n    ")])])],1)},i=[],d={name:"Way",props:{way:Object},data(){return{orderColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",classes:"bg-purple-2",headerClasses:"bg-purple-2 text-bold"},{name:"p",label:"П",field:"p"},{name:"m",label:"М",field:"m"},{name:"n",label:"Н",field:"n"}]}},methods:{}},p=d,m=s("2877"),u=s("f09f"),c=s("a370"),h=s("eaac"),y=s("eebe"),w=s.n(y),f=Object(m["a"])(p,o,i,!1,null,null,null),b=f.exports;w()(f,"components",{QCard:u["a"],QCardSection:c["a"],QTable:h["a"]});var g={name:"PrintWaysByDays",components:{Way:b},props:{week:Array},data(){return{}}},_=g,q=Object(m["a"])(_,l,n,!1,null,null,null),v=q.exports,C={name:"PageIndex",components:{PrintWaysByDays:v},data(){return{file:null,textFile:null,shops:[],orders:[],week:[],TT:30,shopColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",sortable:!0,classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"x",label:"X",field:"x"},{name:"y",label:"Y",field:"y"}],ordersColumns:[{name:"ttId",align:"center",label:"Магазин",field:"ttId",sortable:!0,classes:"bg-purple-2",headerClasses:"bg-purple-2"},{name:"monP",label:"пн П",field:"monP"},{name:"monM",label:"пн М",field:"monM"},{name:"monN",label:"пн Н",field:"monN"},{name:"tueP",label:"вт П",field:"tueP",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"tueM",label:"вт М",field:"tueM",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"tueN",label:"вт Н",field:"tueN",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"wedP",label:"ср П",field:"wedP"},{name:"wedM",label:"ср М",field:"wedM"},{name:"wedN",label:"ср Н",field:"wedN"},{name:"thuP",label:"чт П",field:"thuP",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"thuM",label:"чт М",field:"thuM",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"thuN",label:"чт Н",field:"thuN",classes:"bg-grey-2",headerClasses:"bg-grey-2"},{name:"friP",label:"пт П",field:"friP"},{name:"friM",label:"пт М",field:"friM"},{name:"friN",label:"пт Н",field:"friN"}]}},methods:{async input(){const e=new FileReader;e.readAsText(this.file),this.textFile=await new Promise(((t,s)=>{e.onload=s=>t(e.result)})),await this.setShops(),await this.setOrders();for(let t of["mon","tue","wed","thu","fri"])this.week.push({day:t,cars:await this.loadWaysByDays(t)});console.log("this.week",this.week)},async loadWaysByDays(e){let t=await this.getDayOrders(e);console.log(`===== Cars for ${e.toUpperCase()} =====`);let s=[],a=1,r=!0,l=!0,n=null;while(r)n=await this.loadWayP(t,a),this.getWayBoxes(n)>0&&(s.push(n),a++),this.getWayBoxes(n)<120&&(r=!1);while(l)n=await this.loadWayM(t,a),this.getWayBoxes(n)>0&&(s.push(n),a++),this.getCountBoxes(t)<1&&(l=!1);return console.log("cars",s),console.log("dayOrders",t),s},loadWayM(e,t){let s=0,a={id:t,orders:[]},r=0;for(let l=0;l<e.length;l++)if(+e[l].m+ +e[l].n>0&&s+ +e[l].m+ +e[l].n<=120&&(l-r<9||0===r)){let t={ttId:l+1};+e[l].m>0&&(t.m=+e[l].m),+e[l].n>0&&(t.n=+e[l].n),a.orders.push(t),s+=+e[l].m+ +e[l].n,e[l].m=0,e[l].n=0,r=l}return a.sum=this.getWayBoxes(a),a=this.getSequenceTT(a),a},loadWayP(e,t){let s=0,a=0,r=0;while(s<this.TT&&0===+e[s].p)s++;let l={id:t,orders:[]};while(s+a<this.TT&&r+ +e[s+a].p<=120)+e[s+a].p>0&&(l.orders.push({ttId:s+a+1,p:+e[s+a].p}),r+=+e[s+a].p,e[s+a].p=0),a++;a=0;while(s+a<this.TT&&r+ +e[s+a].n<=120)l.orders[a].p>0&&(l.orders[a].n=+e[s+a].n,r+=+e[s+a].n,e[s+a].n=0),a++;return s+a<this.TT&&(l.orders[a].n=120-r,e[s+a].n-=120-r),l.sum=this.getWayBoxes(l),l=this.getSequenceTT(l),l},getSequenceTT(e){const t=e.orders.map((e=>e.ttId));if(!t.length)return"0";const s=this.getNextTT("0",t);e.seq=s.sort(((e,t)=>+e.split("km")[1]>+t.split("km")[1]?1:-1)),e.bestSeq=e.seq[0].split("km")[0],e.bestSeqKM=e.seq[0].split("km")[1];const a=e.bestSeq.split("-").length;return e.time=3*+e.bestSeqKM+.5*+e.sum+15*(a-2),e},getNextTT(e,t){if(t.length<2){const s=`${e}-${t[0]}-0`;return[`${s}km${this.getKM(s)}`]}let s=[];return t.forEach((a=>{s=[...s,...this.getNextTT(`${e}-${a}`,t.filter((e=>e!==a)))]})),s},getKM(e){const t=e.split("-");let s=0;for(let a=0;a<t.length-1;a++){const e=this.shops.filter((e=>e.ttId===t[a]))[0],r=this.shops.filter((e=>e.ttId===t[a+1]))[0];s+=Math.abs(+e.x-+r.x)+Math.abs(+e.y-+r.y)}return s},getWayBoxes(e){return e.orders&&e.orders.length?e.orders.map((e=>(e.p?e.p:0)+(e.n?e.n:0)+(e.m?e.m:0))).reduce(((e,t)=>e+t)):0},getCountBoxes(e){return e.length?e.map((e=>(e.p?e.p:0)+(e.n?e.n:0)+(e.m?e.m:0))).reduce(((e,t)=>e+t)):0},setShops(){this.shops=this.textFile.replaceAll("\r","").split("\n").slice(2,33).map((e=>e.split(";").slice(0,3))).map((e=>({ttId:e[0],x:e[1],y:e[2]})))},setOrders(){this.orders=this.textFile.replaceAll("\r","").split("\n").slice(2,32).map((e=>[e.split(";")[0],...e.split(";").slice(3,18)])).map((e=>({ttId:e[0],mon:{p:e[1],m:e[2],n:e[3]},tue:{p:e[4],m:e[5],n:e[6]},wed:{p:e[7],m:e[8],n:e[9]},thu:{p:e[10],m:e[11],n:e[12]},fri:{p:e[13],m:e[12],n:e[13]}})))},getDayOrders(e){switch(e){case"mon":return this.orders.map((e=>({ttId:e.ttId,p:e.mon.p,m:e.mon.m,n:e.mon.n})));case"tue":return this.orders.map((e=>({ttId:e.ttId,p:e.tue.p,m:e.tue.m,n:e.tue.n})));case"wed":return this.orders.map((e=>({ttId:e.ttId,p:e.wed.p,m:e.wed.m,n:e.wed.n})));case"thu":return this.orders.map((e=>({ttId:e.ttId,p:e.thu.p,m:e.thu.m,n:e.thu.n})));case"fri":return this.orders.map((e=>({ttId:e.ttId,p:e.fri.p,m:e.fri.m,n:e.fri.n})));default:return{}}}}},k=C,x=s("9989"),I=s("7d53"),T=s("bd08"),M=s("db86"),P=Object(m["a"])(k,a,r,!1,null,null,null);t["default"]=P.exports;w()(P,"components",{QPage:x["a"],QFile:I["a"],QTable:h["a"],QTr:T["a"],QTd:M["a"]})}}]);